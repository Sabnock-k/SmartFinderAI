postgresql pass: password

-- Create database
CREATE DATABASE IF NOT EXISTS campusfinder_ai;
USE campusfinder_ai;


-- vector
CREATE EXTENSION IF NOT EXISTS vector;

-- Table: users
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    full_name VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    points INT DEFAULT 0,
    is_admin BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    facebook_account_link VARCHAR(255),
    reset_token VARCHAR(500),
    reset_token_expires TIMESTAMP
);


-- Table: found_items
CREATE TABLE found_items (
    found_item_id SERIAL PRIMARY KEY,                -- auto-increment integer
    reported_by_user_id INTEGER NOT NULL,            -- FK to users table
    description TEXT NOT NULL,                       -- description of the found item
    category VARCHAR(100),                           -- optional category
    image_url VARCHAR(255),                          -- image link
    location_description VARCHAR(255),               -- where it was found
    date_time_found TIMESTAMP NOT NULL,              -- when it was found
    is_approved BOOLEAN DEFAULT false,               -- moderation flag
    reunited BOOLEAN DEFAULT false,                  -- whether item is reunited with owner
    status VARCHAR(50) DEFAULT 'available', -- current item status
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- auto-set on insert
    embedding VECTOR(3072),                          -- requires pgvector

    -- Foreign key constraint to users table
    CONSTRAINT fk_reported_by FOREIGN KEY (reported_by_user_id)
        REFERENCES users(user_id)
        ON DELETE CASCADE
);


CREATE TABLE claim_requests (
    claim_request_id SERIAL PRIMARY KEY,
    found_item_id INT NOT NULL,
    requested_by_user_id INT NOT NULL,
    requested_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    founder_confirmed BOOLEAN DEFAULT FALSE,     -- founder clicks "Returned"
    claimer_confirmed BOOLEAN DEFAULT FALSE,     -- claimer clicks "Returned"
    admin_approved BOOLEAN DEFAULT FALSE,        -- admin final approval
    status VARCHAR(50) DEFAULT 'pending',        -- pending, confirmed, approved, rejected

    CONSTRAINT fk_found_item FOREIGN KEY (found_item_id)
        REFERENCES found_items(found_item_id)
        ON DELETE CASCADE,

    CONSTRAINT fk_requested_by FOREIGN KEY (requested_by_user_id)
        REFERENCES users(user_id)
        ON DELETE CASCADE
);

-- Table: claimed_items
CREATE TABLE claimed_items (
    claim_id SERIAL PRIMARY KEY,
    found_item_id INT NOT NULL,
    claimed_by_user_id INT NOT NULL,
    claimed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_found_item_claimed FOREIGN KEY (found_item_id)
        REFERENCES found_items(found_item_id)
        ON DELETE CASCADE,

    CONSTRAINT fk_claimed_by FOREIGN KEY (claimed_by_user_id)
        REFERENCES users(user_id)
        ON DELETE CASCADE
);

-- Table: notifications
CREATE TABLE IF NOT EXISTS notifications (
    notification_id SERIAL PRIMARY KEY,
    recipient_user_id INT NOT NULL REFERENCES users(user_id) ON DELETE CASCADE,
    found_item_id INT NOT NULL REFERENCES found_items(found_item_id) ON DELETE CASCADE,
    message TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- REWARDS CATALOG (Available rewards)
CREATE TABLE rewards_catalog (
    reward_id SERIAL PRIMARY KEY,
    title VARCHAR(100) NOT NULL,
    description TEXT,
    points_cost INT NOT NULL,
    icon VARCHAR(50),
    qr_data TEXT,
    qr_url  TEXT,
    is_active BOOLEAN DEFAULT TRUE
);

CREATE TABLE reward_redemptions (
    redemption_id SERIAL PRIMARY KEY,
    user_id INT NOT NULL REFERENCES users(user_id) ON DELETE CASCADE,
    reward_id INT NOT NULL REFERENCES rewards_catalog(reward_id),
    redeemed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);